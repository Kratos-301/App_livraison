{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\krato\\\\Desktop\\\\app_livraison\\\\frontend\\\\src\\\\livreur\\\\pages\\\\Dashboard.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useMemo } from 'react';\nimport axios from 'axios';\nimport Header from '../Header/Header';\nimport { io } from 'socket.io-client';\nimport '../styles/barre.css';\nimport '../styles/attente.css';\nimport '../styles/accueil.css';\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Accueil = () => {\n  _s();\n  const [user, setUser] = useState(null);\n  const [commandes, setCommandes] = useState([]);\n  const [livreurs, setLivreurs] = useState([]);\n\n  // Fetch initial data + polling\n  const fetchData = () => {\n    axios.get('http://localhost:3000/api/commande/accueil', {\n      withCredentials: true\n    }).then(res => {\n      const data = res.data;\n      setUser(data.user);\n      setCommandes(data.commandes || []);\n      setLivreurs(data.livreurs || []);\n    }).catch(console.error);\n  };\n  useEffect(() => {\n    fetchData();\n    const interval = setInterval(fetchData, 5000);\n    const socket = io('http://localhost:3000');\n    socket.on('livreurStatusChange', fetchData);\n    socket.on('commandeCreated', fetchData);\n    socket.on('commandeConfirmed', fetchData);\n    socket.on('commandeAnnulee', fetchData);\n    return () => {\n      clearInterval(interval);\n      socket.disconnect();\n    };\n  }, []);\n  const handleCommande = livreur => {\n    navigator.geolocation.getCurrentPosition(pos => {\n      axios.post('http://localhost:3000/api/commande/creer', {\n        client_id: user.id,\n        client_nom: user.nom,\n        client_num: user.telephone,\n        livreur_id: livreur.id,\n        livreur_nom: livreur.nom,\n        livreur_marque_moto: livreur.marque_moto,\n        latitude: pos.coords.latitude,\n        longitude: pos.coords.longitude,\n        statut: 1,\n        statut_2: 0,\n        statut_3: 0,\n        disponibilite: 0\n      }, {\n        withCredentials: true\n      }).then(fetchData).catch(console.error);\n    }, () => alert(\"⛔ Active la géoloc\"));\n  };\n  const formVisible = useMemo(() => {\n    return !commandes.some(cmd => cmd.statut === 1 && cmd.statut_2 === 0 && cmd.statut_3 === 0 || cmd.statut === 1 && cmd.statut_2 === 1 && cmd.statut_3 === 0);\n  }, [commandes]);\n  if (user === null) return /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"Chargement en cours\\u2026\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 29\n  }, this);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mes-barre\",\n      children: /*#__PURE__*/_jsxDEV(Header, {\n        user: user\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"main-content\",\n      children: [formVisible && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n          children: [\"Bienvenue \", user.nom]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"all-form\",\n          id: \"okjik\",\n          children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n            children: \"Les livreurs\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 80,\n            columnNumber: 13\n          }, this), livreurs.length === 0 ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"alert alert-warning\",\n            children: \"\\uD83D\\uDED1 Aucun livreur en ligne.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 15\n          }, this) : livres.map(livreur => /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `livreur-card ${livreur.est_occupe ? 'occupe' : 'disponible'}`,\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: livreur.nom\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 85,\n              columnNumber: 17\n            }, this), \" \\u2013 \", livreur.marque_moto, livreur.est_occupe ? /*#__PURE__*/_jsxDEV(\"span\", {\n              className: \"statut\",\n              style: {\n                color: 'red'\n              },\n              children: \"\\uD83D\\uDD34 Occup\\xE9\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 87,\n              columnNumber: 19\n            }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => handleCommande(livreur),\n              children: \"Commander\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 89,\n              columnNumber: 19\n            }, this)]\n          }, livreur.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 84,\n            columnNumber: 15\n          }, this))]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true), commandes.map(cmd => cmd.statut === 1 && cmd.statut_2 === 0 && cmd.statut_3 === 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"p\", {\n          children: [\"Commande en cours : \", cmd.livreur_nom]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 99,\n          columnNumber: 15\n        }, this)\n      }, cmd.id, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 13\n      }, this))]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n_s(Accueil, \"L1ZNek0D0yC0YsppVWqnSbT0+Ns=\");\n_c = Accueil;\nexport default Accueil;\nvar _c;\n$RefreshReg$(_c, \"Accueil\");","map":{"version":3,"names":["React","useEffect","useState","useMemo","axios","Header","io","jsxDEV","_jsxDEV","Fragment","_Fragment","Accueil","_s","user","setUser","commandes","setCommandes","livreurs","setLivreurs","fetchData","get","withCredentials","then","res","data","catch","console","error","interval","setInterval","socket","on","clearInterval","disconnect","handleCommande","livreur","navigator","geolocation","getCurrentPosition","pos","post","client_id","id","client_nom","nom","client_num","telephone","livreur_id","livreur_nom","livreur_marque_moto","marque_moto","latitude","coords","longitude","statut","statut_2","statut_3","disponibilite","alert","formVisible","some","cmd","children","fileName","_jsxFileName","lineNumber","columnNumber","className","length","livres","map","est_occupe","style","color","onClick","_c","$RefreshReg$"],"sources":["C:/Users/krato/Desktop/app_livraison/frontend/src/livreur/pages/Dashboard.jsx"],"sourcesContent":["import React, { useEffect, useState, useMemo } from 'react';\r\nimport axios from 'axios';\r\nimport Header from '../Header/Header';\r\nimport { io } from 'socket.io-client';\r\n\r\nimport '../styles/barre.css';\r\nimport '../styles/attente.css';\r\nimport '../styles/accueil.css';\r\n\r\nconst Accueil = () => {\r\n  const [user, setUser] = useState(null);\r\n  const [commandes, setCommandes] = useState([]);\r\n  const [livreurs, setLivreurs] = useState([]);\r\n\r\n  // Fetch initial data + polling\r\n  const fetchData = () => {\r\n    axios.get('http://localhost:3000/api/commande/accueil', { withCredentials: true })\r\n      .then(res => {\r\n        const data = res.data;\r\n        setUser(data.user);\r\n        setCommandes(data.commandes || []);\r\n        setLivreurs(data.livreurs || []);\r\n      })\r\n      .catch(console.error);\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n    const interval = setInterval(fetchData, 5000);\r\n    const socket = io('http://localhost:3000');\r\n    socket.on('livreurStatusChange', fetchData);\r\n    socket.on('commandeCreated', fetchData);\r\n    socket.on('commandeConfirmed', fetchData);\r\n    socket.on('commandeAnnulee', fetchData);\r\n    return () => {\r\n      clearInterval(interval);\r\n      socket.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  const handleCommande = (livreur) => {\r\n    navigator.geolocation.getCurrentPosition(pos => {\r\n      axios.post('http://localhost:3000/api/commande/creer', {\r\n        client_id: user.id,\r\n        client_nom: user.nom,\r\n        client_num: user.telephone,\r\n        livreur_id: livreur.id,\r\n        livreur_nom: livreur.nom,\r\n        livreur_marque_moto: livreur.marque_moto,\r\n        latitude: pos.coords.latitude,\r\n        longitude: pos.coords.longitude,\r\n        statut: 1,\r\n        statut_2: 0,\r\n        statut_3: 0,\r\n        disponibilite: 0,\r\n      }, { withCredentials: true })\r\n      .then(fetchData)\r\n      .catch(console.error);\r\n    }, () => alert(\"⛔ Active la géoloc\"));\r\n  };\r\n\r\n  const formVisible = useMemo(() => {\r\n    return !commandes.some(cmd =>\r\n      (cmd.statut === 1 && cmd.statut_2 === 0 && cmd.statut_3 === 0) ||\r\n      (cmd.statut === 1 && cmd.statut_2 === 1 && cmd.statut_3 === 0)\r\n    );\r\n  }, [commandes]);\r\n\r\n  if (user === null) return <p>Chargement en cours…</p>;\r\n\r\n  return (\r\n    <>\r\n      <div className=\"mes-barre\">\r\n        <Header user={user}/>\r\n      </div>\r\n      <div className=\"main-content\">\r\n        { formVisible && <>\r\n          <h1>Bienvenue {user.nom}</h1>\r\n          <div className=\"all-form\" id=\"okjik\">\r\n            <h3>Les livreurs</h3>\r\n            {livreurs.length === 0 ? (\r\n              <div className=\"alert alert-warning\">🛑 Aucun livreur en ligne.</div>\r\n            ) : livres.map(livreur => (\r\n              <div key={livreur.id} className={`livreur-card ${livreur.est_occupe ? 'occupe' : 'disponible'}`}>\r\n                <span>{livreur.nom}</span> – {livreur.marque_moto}\r\n                {livreur.est_occupe ? (\r\n                  <span className=\"statut\" style={{color:'red'}}>🔴 Occupé</span>\r\n                ) : (\r\n                  <button onClick={() => handleCommande(livreur)}>Commander</button>\r\n                )}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </> }\r\n\r\n        { commandes.map(cmd => (\r\n          (cmd.statut===1 && cmd.statut_2===0 && cmd.statut_3===0) && (\r\n            <div key={cmd.id}>\r\n              <p>Commande en cours : {cmd.livreur_nom}</p>\r\n            </div>\r\n          )\r\n        )) }\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Accueil;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}